<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Absensi Barcode - Professional&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Tambahkan styling yang diperlukan */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.auth-section { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.admin-panel { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.scanner-section { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Firebase &amp; Instascan --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://rawgit.com/schmik/instascan/master/instascan.min.js"&gt;&lt;/script&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Auth Section --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="auth-section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="googleLogin"&gt;Login with Google&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- User Interface --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="scanner-section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1&gt;Welcome, &lt;span id="userName"&gt;&lt;/span&gt;&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;video id="preview"&gt;&lt;/video&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button onclick="startScanning()"&gt;Start Scan&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="userHistory"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Admin Panel --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="admin-panel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;Admin Dashboard&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="allAttendance"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Firebase Configuration</p>
<p class="p1"><span class="Apple-converted-space">        </span>const firebaseConfig = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>apiKey: "YOUR_API_KEY",</p>
<p class="p1"><span class="Apple-converted-space">            </span>authDomain: "YOUR_AUTH_DOMAIN",</p>
<p class="p1"><span class="Apple-converted-space">            </span>projectId: "YOUR_PROJECT_ID",</p>
<p class="p1"><span class="Apple-converted-space">            </span>storageBucket: "YOUR_STORAGE_BUCKET",</p>
<p class="p1"><span class="Apple-converted-space">            </span>messagingSenderId: "YOUR_SENDER_ID",</p>
<p class="p1"><span class="Apple-converted-space">            </span>appId: "YOUR_APP_ID"</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize Firebase</p>
<p class="p1"><span class="Apple-converted-space">        </span>const app = firebase.initializeApp(firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const auth = firebase.auth();</p>
<p class="p1"><span class="Apple-converted-space">        </span>const db = firebase.firestore();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Admin Configuration</p>
<p class="p1"><span class="Apple-converted-space">        </span>const SUPER_ADMINS = ["admin@yourdomain.com"]; // Daftar email super admin</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Auth State Listener</p>
<p class="p1"><span class="Apple-converted-space">        </span>auth.onAuthStateChanged(async (user) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (user) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const isAdmin = SUPER_ADMINS.includes(user.email);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('.auth-section').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('.scanner-section').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('userName').textContent = user.displayName;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>if(isAdmin) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.querySelector('.admin-panel').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>loadAllAttendance();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>loadUserHistory(user.uid);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('.auth-section').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('.scanner-section').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('.admin-panel').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Google Login</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('googleLogin').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const provider = new firebase.auth.GoogleAuthProvider();</p>
<p class="p1"><span class="Apple-converted-space">            </span>auth.signInWithPopup(provider);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Attendance System</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function recordAttendance(roomData) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const user = auth.currentUser;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const attendanceData = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>userId: user.uid,</p>
<p class="p1"><span class="Apple-converted-space">                </span>userName: user.displayName,</p>
<p class="p1"><span class="Apple-converted-space">                </span>room: roomData.id,</p>
<p class="p1"><span class="Apple-converted-space">                </span>roomName: roomData.name,</p>
<p class="p1"><span class="Apple-converted-space">                </span>timestamp: firebase.firestore.FieldValue.serverTimestamp()</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>await db.collection('attendance').add(attendanceData);</p>
<p class="p1"><span class="Apple-converted-space">            </span>loadUserHistory(user.uid);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function loadUserHistory(uid) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const snapshot = await db.collection('attendance')</p>
<p class="p1"><span class="Apple-converted-space">                </span>.where('userId', '==', uid)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.orderBy('timestamp', 'desc')</p>
<p class="p1"><span class="Apple-converted-space">                </span>.limit(10)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.get();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>displayHistory(snapshot, 'userHistory');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function loadAllAttendance() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const snapshot = await db.collection('attendance')</p>
<p class="p1"><span class="Apple-converted-space">                </span>.orderBy('timestamp', 'desc')</p>
<p class="p1"><span class="Apple-converted-space">                </span>.limit(50)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.get();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>displayHistory(snapshot, 'allAttendance');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function displayHistory(snapshot, elementId) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const container = document.getElementById(elementId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>container.innerHTML = snapshot.docs.map(doc =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const data = doc.data();</p>
<p class="p1"><span class="Apple-converted-space">                </span>return `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="attendance-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h3&gt;${data.roomName}&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;${data.userName} - ${data.timestamp?.toDate().toLocaleString()}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}).join('');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Barcode Scanner</p>
<p class="p1"><span class="Apple-converted-space">        </span>let scanner = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const rooms = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>"ROOM-001": { id: "ROOM-001", name: "Ruang Meeting A" },</p>
<p class="p1"><span class="Apple-converted-space">            </span>"ROOM-002": { id: "ROOM-002", name: "Lab Komputer" }</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function startScanning() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>Instascan.Camera.getCameras().then(cameras =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (cameras.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>scanner = new Instascan.Scanner({ video: document.getElementById('preview') });</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>scanner.addListener('scan', content =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if(rooms[content]) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>recordAttendance(rooms[content]);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>alert(`Berhasil absen di ${rooms[content].name}`);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>alert("Barcode tidak valid");</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>scanner.start(cameras[0]);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
